


;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;														;;
;;    CASTLE WALL PIECES FOR THE NEW WALL BUILD SYSTEM		;;
;;														;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

Object MordorCastleWallSegment
  
	// *** ART Parameters ***  
  	SelectPortrait = BPIWall
  
	Draw = W3DScriptedModelDraw ModuleTag_Draw
		OkToChangeModelColor  = Yes
		UseStandardModelNames = Yes
		DefaultModelConditionState
			Model = DolGulWall2
		End
		
		AnimationState			= ACTIVELY_BEING_CONSTRUCTED
		Flags = ADJUST_HEIGHT_BY_CONSTRUCTION_PERCENT
		End
					
		IdleAnimationState
;			Flags = ADJUST_HEIGHT_BY_CONSTRUCTION_PERCENT
;			Animation				=	ReallyDamagedanimation
;				AnimationName		=	 GBWallrampart.GBWallrampart
;				AnimationMode		=	LOOP
; 			End
			StateName = STATE_None
		End	

		;--damaged building
	  
	  	ModelConditionState  = DAMAGED UPGRADE_NUMENOR_STONEWORK
			Model         = DolGulWall2_D1 
			Texture		  = dolgolgate_d.tga dolgolgate_d_u.tga
			Texture		  = dolgolgate_d1.tga dolgolgate_d1_u.tga
		End
	  	ModelConditionState  = UPGRADE_NUMENOR_STONEWORK
			Model         = DolGulWall2 
			Texture		  = dolgolgate.tga dolgolgate_u.tga
		End		
		AnimationState = DAMAGED
		End	   
		ModelConditionState  = DAMAGED
			Model         = DolGulWall2_D1  
		End
		AnimationState = DAMAGED
		End	    
		
		ModelConditionState  = REALLYDAMAGED
			Model         = DolGulWall2_D2
		End
	    
;	    AnimationState = REALLYDAMAGED
;     		Animation				=	RubbleAnimation
;				AnimationName		=	 DolGulWall_D2.DolGulWall_D2
;				AnimationMode		=	ONCE
; 			End
;		    EnteringStateFX	= FX_BuildingReallyDamaged
;		End
 
;		ModelConditionState  = COLLAPSING
;			Model         = DolGulWall_D3
;		End
		
;		AnimationState = COLLAPSING
;     		Animation				=	RubbleAnimation
;				AnimationName		=	 DolGulWall_D3.DolGulWall_D3
;				AnimationMode		=	ONCE
; 			End
;		End

;		ModelConditionState  = RUBBLE
;			Model         = None  
;		End  
		
;		ModelConditionState  = POST_RUBBLE
;			Model         = NONE
;			ParticleSysBone NONE SmokeBuildingMediumRubble
;		End
		
;		AnimationState = POST_RUBBLE
;		End

;		ModelConditionState  = POST_COLLAPSE
;		Model         = None
;			ParticleSysBone NONE SmokeBuildingMediumRubble
;		End
		
;		AnimationState = POST_COLLAPSE
;		End 


	End

	Draw = W3DScriptedModelDraw ModuleTag_Draw_Rubble
		OkToChangeModelColor  = Yes
		UseStandardModelNames = Yes
		DefaultModelConditionState
			Model = None
		End
	
		ModelConditionState  = COLLAPSING
			Model         = GBWall_Rubble
		End
		
		ModelConditionState  = RUBBLE
			Model         = GBWall_Rubble
		End
	    
		ModelConditionState  = POST_RUBBLE
			Model         = GBWall_Rubble
		End

		ModelConditionState  = POST_COLLAPSE
			Model         = None
		End
	End

	// ***DESIGN parameters ***
	DisplayName         = OBJECT:MordorCastleWallSegment
	Side                = Mordor
	EditorSorting       = STRUCTURE
	ThreatLevel = 1.0
	 
	BuildCost           = BFA_ISENGARD_CASTLE_WALLSEGMENT_BUILDCOST
	BuildTime           = BFA_ISENGARD_CASTLE_WALLSEGMENT_BUILDTIME
	VisionRange         = 160.0          // Shroud clearing distance
	ShroudClearingRange = 160
	CommandSet			= MordorWallUpgradeNodeCommandSet

	// *** AUDIO Parameters ***

	#include "..\..\..\Includes\StandardBuildingEvaEvents.inc"

	VoiceSelect						= Gui_PlotSelect2
    VoiceSelectUnderConstruction	= BuildingEvilVoiceSelectUnderConstruction

	SoundOnDamaged					= BuildingLightDamageStone
	SoundOnReallyDamaged			= BuildingHeavyDamageStone

    UnitSpecificSounds
        UnderConstruction		= WallConstructionLoop  ; Built first time
		; UnderRepairFromDamage	= NoSound					; Repaired No animation on the building, so don't bother playing sound
		UnderRepairFromRubble	= WallConstructionLoop	; Repaired from completely destroyed (not used???)
    End

	ClientBehavior = ModelConditionAudioLoopClientBehavior ModuleTag_PlayCollapseSound
		ModelCondition = REQUIRED:RUBBLE Sound:BuildingSink
	End

	CampnessValue = CAMPNESS_WALL

	// *** ENGINEERING Parameters ***
	RadarPriority       = STRUCTURE
	KindOf              = PRELOAD STRUCTURE SELECTABLE IMMOBILE WALL_SEGMENT SCALEABLE_WALL MADE_OF_STONE
	ThreatBreakdown ThreatBreakdown_ModuleTag
		AIKindOf = WALL
	End
	 
	//This is important to let the user select the rubble to begin self repair
	KeepSelectableWhenDead	= Yes
 
	Behavior            = GettingBuiltBehavior ModuleTag_04
		SelfBuildingLoop			= WallConstructionLoop			// Only played if we DON'T spawn a worker
		SelfRepairFromDamageLoop	= NoSound						// This doesn't cause an animation, so don't bother playing a sound
		SelfRepairFromRubbleLoop	= WallConstructionLoop
		UseSpawnTimerWithoutWorker 		= Yes
		SpawnTimer	= BFA_DEFAULT_STRUCTURE_HEALDELAY
		RebuildTimeSeconds			= BFA_ISENGARD_CASTLE_WALLSEGMENT_BUILDTIME
	End

	Body                = StructureBody ModuleTag_05
		MaxHealth				= BFA_ISENGARD_CASTLE_WALLSEGMENT_HEALTH
		MaxHealthDamaged		= BFA_ISENGARD_CASTLE_WALLSEGMENT_HEALTH_DAMAGED
		MaxHealthReallyDamaged	= BFA_ISENGARD_CASTLE_WALLSEGMENT_HEALTH_REALLY_DAMAGED
	End
 
	// These should always appear together on wall segments
	Behavior = KeepObjectDie ModuleTag_IWantRubble 
		DeathTypes			= ALL -SUICIDED
	End
	Behavior            = SlowDeathBehavior ModuleTag_SlowDeath
		DeathTypes			= NONE +SUICIDED
		DestructionDelay = 5000
	End												
	// These should always appear together on wall segments

	Behavior = ReplaceSelfUpgrade ModuleTag_Replace_With_Hub
		ReplaceWith = MordorCastleWallHub
		TriggeredBy = Upgrade_MordorWallHub
		ConflictsWith = Upgrade_MordorWallRegularGate
	End
		
	Behavior = ReplaceSelfUpgrade ModuleTag_Replace_With_Gate
		ReplaceWith = MordorCastleWallGate
		TriggeredBy = Upgrade_MordorWallRegularGate
		ConflictsWith = Upgrade_MordorWallHub
	End
	
		Behavior = ReplaceSelfUpgrade ModuleTag_Replace_With_Catapult
		ReplaceWith = MordorWallCatapultSmall
		TriggeredBy = Upgrade_MordorWallCatapult
		ConflictsWith = Upgrade_MordorWallHub Upgrade_MordorWallRegularGate Upgrade_MordorWallTower
	End
	
		Behavior = ReplaceSelfUpgrade ModuleTag_Replace_With_Tower
		ReplaceWith = MordorWallTowerSmall
		TriggeredBy = Upgrade_MordorWallTower
		ConflictsWith = Upgrade_MordorWallHub Upgrade_MordorWallRegularGate Upgrade_MordorWallCatapult
	End

	Behavior = ProductionUpdate ModuleTag_RequiredForUpgradeProduction
	End

	Behavior = InheritUpgradeCreate ModuleTag_InheritStonework
		Radius = BFA_ISENGARD_FORTRESS_WALL_EFFECTIVE_RADIUS
		Upgrade = Upgrade_MordorFortressMorgulSorcery
		ObjectFilter = ANY +MordorFortressCitadel
	End

	Behavior = AttributeModifierUpgrade ModuleTag_Reinforced
		TriggeredBy				= Upgrade_MordorFortressMorgulSorcery
		AttributeModifier		= IronPlatingExpansion_Bonus		
	End

	Behavior = ModelConditionUpgrade ModuleTag_ShowThePlating
		TriggeredBy			= Upgrade_MordorFortressMorgulSorcery		
		AddConditionFlags	= UPGRADE_NUMENOR_STONEWORK
		Permanent			= Yes
	End
	
	ArmorSet
		Conditions        = None
		Armor             = IsenWallArmor
		DamageFX          = None
	End

	;//	Geometry for the temp men small wall segment
	Geometry              = BOX
	GeometryMajorRadius   = 5.0		;10.0 
	GeometryMinorRadius   = 20.0
	GeometryHeight        = 40.0	;47
	GeometryIsSmall       = No
	  
	;Geometry              = BOX
	;GeometryMajorRadius   = 25.0
	;GeometryMinorRadius   = 20.0
	;GeometryHeight        = 50
	;GeometryIsSmall       = No
  
	Shadow                = SHADOW_VOLUME
	BuildCompletion     = PLACED_BY_PLAYER
End

;---------------------------------------------
Object MordorCastleWallHub
  
  ; *** ART Parameters ***
  
  	SelectPortrait = BPIWall_WallHub
 
 ; *** ART Parameters ***
	Draw = W3DScriptedModelDraw ModuleTag_Draw
		OkToChangeModelColor  = Yes
		UseStandardModelNames = Yes
		StaticModelLODMode		= yes ;// Will append M or L to the skin name depending on GameLOD

	DefaultModelConditionState
			Model = DolGulHub
		End
		
		AnimationState			= ACTIVELY_BEING_CONSTRUCTED
		Flags = ADJUST_HEIGHT_BY_CONSTRUCTION_PERCENT
		End
		
		;--damaged building
	  	ModelConditionState  = DAMAGED UPGRADE_NUMENOR_STONEWORK
			Model         = DolGulHub_D1 
			Texture		  = dolgolgate_d.tga dolgolgate_d_u.tga
			Texture		  = dolgolgate_d1.tga dolgolgate_d1_u.tga
		End
	  	ModelConditionState  = UPGRADE_NUMENOR_STONEWORK
			Model         = DolGulHub 
			Texture		  = dolgolgate.tga dolgolgate_u.tga
		End		
		ModelConditionState  = DAMAGED
			Model         = DolGulHub_D1  ;DBWallRmprtN_D1 
		End
		AnimationState = DAMAGED
		End	    
		
		ModelConditionState  = REALLYDAMAGED
			Model         = DolGulHub_D2
		End
	    
	    AnimationState = REALLYDAMAGED
     		Animation				=	RubbleAnimation
				AnimationName		=	 DolGulHub_D2.DolGulHub_D2
				AnimationMode		=	ONCE
 			End
		    EnteringStateFX	= FX_BuildingReallyDamaged
		End
 
		ModelConditionState  = COLLAPSING
			Model         = DolGulHub_D3
		End
		
		AnimationState = COLLAPSING
     		Animation				=	RubbleAnimation
				AnimationName		=	 DolGulHub_D3.DolGulHub_D3
				AnimationMode		=	ONCE
 			End
		End

;		ModelConditionState  = RUBBLE
;			Model         = None  
;		End  
		
;		ModelConditionState  = POST_RUBBLE
;			Model         = NONE
;			ParticleSysBone NONE SmokeBuildingMediumRubble
;		End
		
;		AnimationState = POST_RUBBLE
;		End

;		ModelConditionState  = POST_COLLAPSE
;		Model         = None
;			ParticleSysBone NONE SmokeBuildingMediumRubble
;		End
		
;		AnimationState = POST_COLLAPSE
;		End 
		
	End
 
	; ***DESIGN parameters ***
	RadarPriority       = STRUCTURE	
	DisplayName         = OBJECT:MordorCastleWallHub
	Side                = Mordor
	EditorSorting       = STRUCTURE
	ThreatLevel = 1.0
	 
	BuildCost           = BFA_ISENGARD_CASTLE_WALLHUB_BUILDCOST
	BuildTime           = BFA_ISENGARD_CASTLE_WALLHUB_BUILDTIME
	VisionRange         = 160.0          ; Shroud clearing distance
	ShroudClearingRange = 160



	CommandSet = MordorCastleWallHubCommandSet
	

	; *** AUDIO Parameters ***
	#include "..\..\..\Includes\StandardBuildingEvaEvents.inc"

    VoiceSelect						= NeutralWallHubSelect	;Gui_PlotSelect2
    VoiceSelectUnderConstruction	= BuildingEvilVoiceSelectUnderConstruction

	SoundOnDamaged					= BuildingLightDamageStone
	SoundOnReallyDamaged			= BuildingHeavyDamageStone

    UnitSpecificSounds
        UnderConstruction		= BuildingConstructionLoop  ; Built first time
		; UnderRepairFromDamage	= NoSound					; Repaired No animation on the building, so don't bother playing sound
		UnderRepairFromRubble	= BuildingConstructionLoop	; Repaired from completely destroyed (not used???)
    End

	ClientBehavior = ModelConditionAudioLoopClientBehavior ModuleTag_PlayCollapseSound
		ModelCondition = REQUIRED:COLLAPSING	 Sound:BuildingSink
	End

	CampnessValue = CAMPNESS_WALL

	; *** ENGINEERING Parameters ***
	RadarPriority       = STRUCTURE
	KindOf              = PRELOAD STRUCTURE SELECTABLE IMMOBILE SCORE WALL_HUB MADE_OF_STONE WALL_UPGRADE
	ThreatBreakdown ThreatBreakdown_ModuleTag
		AIKindOf = WALL
	End
	 
	Behavior            = GettingBuiltBehavior ModuleTag_04
		UseSpawnTimerWithoutWorker 		= Yes
   		SpawnTimer	= BFA_DEFAULT_STRUCTURE_HEALDELAY
		;SelfBuildingLoop = BuildingConstructionLoop ; Only played if we DON'T spawn a worker
		SelfRepairFromDamageLoop  = WallConstructionLoop
		SelfRepairFromRubbleLoop  = BuildingConstructionLoop
	End

	Body                = StructureBody ModuleTag_05
		MaxHealth				= BFA_ISENGARD_CASTLE_WALLHUB_HEALTH
		MaxHealthDamaged		= BFA_ISENGARD_CASTLE_WALLHUB_HEALTH_DAMAGED
		MaxHealthReallyDamaged	= BFA_ISENGARD_CASTLE_WALLHUB_HEALTH_REALLY_DAMAGED
	End
 

	Behavior				= SlowDeathBehavior ModuleTag_SlowDeath
		DeathTypes			= ALL
		DestructionDelay	= 5000
		;Sound				= INITIAL BuildingSink
	End
	
	Behavior = WallHubBehavior ModuleTag_WALL_HUB

		Options = OPTION_ONE
		MaxBuildoutDistance = BFA_MEN_FORTRESS_WALL_EFFECTIVE_RADIUS
		StaggeredBuildFactor = BFA_STANDARD_WALL_STAGGERED_BUILD_FACTOR

		;;This defines the pattern built on flat terrain
		SegmentTemplateName = MordorCastleWallSegment
		SegmentTemplateName = MordorCastleWallSegment
		SegmentTemplateName = MordorCastleWallSegment
		SegmentTemplateName = MordorCastleWallSegment
		SegmentTemplateName = MordorCastleWallSegment
		SegmentTemplateName = MordorCastleWallSegment
		SegmentTemplateName = MordorCastleWallSegment
		SegmentTemplateName = MordorCastleWallSegment
		SegmentTemplateName = MordorCastleWallHub
		
		BuilderRadius = 20
		
		HubCapTemplateName = MordorCastleWallHub
		DefaultSegmentTemplateName = MordorCastleWallSegment

		CliffCapTemplateName = MordorWallCliffCap		
		;ShoreCapTemplateName = [NAME]		
		;BorderCapTemplateName = [NAME]		
		;ElevatedSegmentTemplateName = [NAME]

	End

	Behavior = TerrainResourceBehavior ModuleTag_NewMoneyDeadSpot
		Radius			= 60		;// How far we try to claim ground
		MaxIncome		= 0			;// If we were to get all we wanted, how much we would earn.  Linear slope to 0 at 0% claim
		IncomeInterval	= 999999	;// How often (in msec) we give that much money
		HighPriority	= Yes		;// A high priority claim gets to pretend it was there first.
		Visible = No 		;// Don't show decal when a resource building is selected.
	End

	Behavior = InheritUpgradeCreate ModuleTag_InheritStonework
		Radius = BFA_ISENGARD_FORTRESS_WALL_EFFECTIVE_RADIUS
		Upgrade = Upgrade_MordorFortressMorgulSorcery
		ObjectFilter = ANY +MordorFortressCitadel
	End

	Behavior = AttributeModifierUpgrade ModuleTag_Reinforced
		TriggeredBy				= Upgrade_MordorFortressMorgulSorcery
		AttributeModifier		= IronPlatingExpansion_Bonus		
	End

	Behavior = ModelConditionUpgrade ModuleTag_ShowThePlating
		TriggeredBy			= Upgrade_MordorFortressMorgulSorcery		
		AddConditionFlags	= UPGRADE_NUMENOR_STONEWORK
		Permanent			= Yes
	End	
	
	ArmorSet
		Conditions        = None
		Armor             = IsenWallArmor
		DamageFX          = None
	End

	;//	Geometry for the temp small men wall hub
	Geometry              = CYLINDER
	GeometryMajorRadius   = 20.0 ; 
	GeometryMinorRadius   = 20.0 ; 
	GeometryHeight        = 70.0
	GeometryIsSmall       = No

	AdditionalGeometry    = BOX
	GeometryMajorRadius   = 5.0		;10.0 
	GeometryMinorRadius   = 20.0
	GeometryHeight        = 40.0	;47
	GeometryIsSmall       = No
	
	Shadow                = SHADOW_VOLUME
	BuildCompletion     = PLACED_BY_PLAYER
	
	GeometryContactPoint = X:-21		Y:22		Z:0			Repair
	GeometryContactPoint = X:23		Y:-20		Z:0			Repair
	GeometryContactPoint = X:5.576		Y:44.987	Z:0
	GeometryContactPoint = X:-38.348	Y:-42.113	Z:0
	GeometryContactPoint = X:-28.448	Y:-0.003	Z:75.14		Swoop
End


;---------------------------------------------------------
Object MordorCastleWallGate
   
   ; *** ART Parameters ***
   
   	SelectPortrait = BPIWall_MainGate
   Draw = W3DScriptedModelDraw ModuleTag_Draw
		OkToChangeModelColor  = Yes
		UseStandardModelNames = Yes
		StaticModelLODMode		= yes ;// Will append M or L to the skin name depending on GameLOD

		DefaultModelConditionState
			Model = DolGulMGate_SKN
		End
		ModelConditionState  = DAMAGED UPGRADE_NUMENOR_STONEWORK
			Model         = DolGulMGate_D1 
			Texture		  = dolgolgate_d.tga dolgolgate_d_u.tga
			Texture		  = dolgolgate_d1.tga dolgolgate_d1_u.tga
		End
	  	ModelConditionState  = UPGRADE_NUMENOR_STONEWORK
			Model         = DolGulMGate_SKN 
			Texture		  = dolgolgate.tga dolgolgate_u.tga
		End	
		IdleAnimationState
 			StateName = STATE_None
		End	

		ModelConditionState  = RUBBLE DOOR_1_OPENING
			Model         = DolGulMGOpen_D3
		End
 		AnimationState = RUBBLE DOOR_1_OPENING
 			Animation = Open 
 				AnimationName	=	DolGulMGOpen_D3.DolGulMGOpen_D3
 				AnimationMode	=	ONCE 
 			End
		End

		ModelConditionState  = RUBBLE
			Model         = DolGulMGate_D3
		End
		
		AnimationState = RUBBLE
      		Animation				=	RubbleAnimation
				AnimationName		=	DolGulMGate_D3.DolGulMGate_D3
				AnimationMode		=	ONCE
  			End
		End

		ModelConditionState = ACTIVELY_BEING_CONSTRUCTED
			Model	= None
		End

;------ Door Animations

		AnimationState = DOOR_1_OPENING 
			Flags = START_FRAME_LAST
			StateName = Door_Open
			Animation				=	Death
				AnimationName		=	DolGulMGate_SKL.DolGulMGate_OP
				AnimationMode		=	ONCE
			End
			BeginScript
				Prev = CurDrawablePrevAnimationState()
				if Prev == "Door_Close" then CurDrawableSetTransitionAnimState("TRANS_Closed_To_Open") end
			EndScript
		End
		TransitionState = TRANS_Closed_To_Open
			Animation = Open 
				AnimationName	=	DolGulMGate_SKL.DolGulMGate_OPN
				AnimationMode	=	ONCE 
			End
		End
    
		AnimationState = DOOR_1_CLOSING 
			Flags = START_FRAME_LAST
			StateName = Door_Close
			Animation				=	Death
				AnimationName		=	DolGulMGate_SKL.DolGulMGate_CL
				AnimationMode		=	ONCE
			End
			BeginScript
				Prev = CurDrawablePrevAnimationState()
				if Prev == "Door_Open" then CurDrawableSetTransitionAnimState("TRANS_Open_To_Closed") end
			EndScript
		End
		TransitionState = TRANS_Open_To_Closed
			Animation = Open 
				AnimationName	=	DolGulMGate_SKL.DolGulMGate_CLS
				AnimationMode	=	ONCE 
			End
		End
		
		ModelConditionState  = DAMAGED
			Model         = DolGulMGate_D1  
		End
		AnimationState = DAMAGED
		EnteringStateFX	= FX_BuildingDamaged
		End	    
		
		ModelConditionState  = REALLYDAMAGED
			Model         = DolGulMGate_D2
		End
	    
	    AnimationState = REALLYDAMAGED
		    EnteringStateFX	= FX_BuildingReallyDamaged
		End
	End

      
   ; ***DESIGN parameters ***
   DisplayName         = OBJECT:MordorCastleWallGate
   Side                = Mordor
   EditorSorting       = STRUCTURE
   ThreatLevel = 1.0
  
   BuildCost           = BFA_ISENGARD_CASTLE_WALLGATE_BUILDCOST
   BuildTime           = BFA_ISENGARD_CASTLE_WALLGATE_BUILDTIME
   VisionRange         = 160.0          ; Shroud clearing distance
   ShroudClearingRange = 160
   
   CommandSet			= CastleGateCommandSet
 
   ; *** AUDIO Parameters ***

	#include "..\..\..\Includes\StandardBuildingEvaEvents.inc"

	VoiceSelect						= GateSelect
    VoiceSelectUnderConstruction	= BuildingEvilVoiceSelectUnderConstruction

 	SoundOnDamaged					= BuildingLightDamageStone
 	SoundOnReallyDamaged			= BuildingHeavyDamageStone

    UnitSpecificSounds
        UnderConstruction		= BuildingConstructionLoop  ; Built first time
		; UnderRepairFromDamage	= NoSound					; Repaired No animation on the building, so don't bother playing sound
		UnderRepairFromRubble	= BuildingConstructionLoop	; Repaired from completely destroyed (not used???)
    End

	;ClientBehavior = ModelConditionAudioLoopClientBehavior ModuleTag_PlayCollapseSound
	;	ModelCondition = REQUIRED:RUBBLE Sound:BuildingSink
	;End

	CampnessValue = CAMPNESS_WALL

   ; *** ENGINEERING Parameters ***
   RadarPriority       = STRUCTURE
   KindOf              = PRELOAD STRUCTURE SELECTABLE IMMOBILE SCORE WALL_UPGRADE MADE_OF_STONE BLOCKING_GATE WALL_GATE
  
	Behavior            = GettingBuiltBehavior ModuleTag_04
		SelfBuildingLoop			= WallConstructionLoop			// Only played if we DON'T spawn a worker
		SelfRepairFromDamageLoop	= NoSound						// This doesn't cause an animation, so don't bother playing a sound
		SelfRepairFromRubbleLoop	= WallConstructionLoop
		SpawnTimer					= -1.0							// Negative means no 'autoheal'
		RebuildTimeSeconds			= BFA_ISENGARD_CASTLE_WALLGATE_BUILDTIME
	End
 
	Body                = StructureBody ModuleTag_05
		MaxHealth				= BFA_ISENGARD_CASTLE_WALLGATE_HEALTH
		MaxHealthDamaged		= BFA_ISENGARD_CASTLE_WALLGATE_HEALTH_DAMAGED
		MaxHealthReallyDamaged	= BFA_ISENGARD_CASTLE_WALLGATE_HEALTH_REALLY_DAMAGED
	End
  
	Behavior            = SlowDeathBehavior ModuleTag_SlowDeath
		DeathTypes			= ALL
		DestructionDelay = 5000 
	End												
	
	Behavior = GateOpenAndCloseBehavior ModuleTag_GATE
		ResetTimeInMilliseconds			= 3000				;important! this must be longer than the gates animation, ir it will twitch
		OpenByDefault					= No
		PercentOpenForPathing			= 50
		SoundOpeningGateLoop			= GateOpenStart
		SoundClosingGateLoop			= GateCloseStart
		SoundFinishedOpeningGate		= GateOpenEnd
		SoundFinishedClosingGate		= GateCloseEnd
		TimeBeforePlayingOpenSound		= 9500
		TimeBeforePlayingClosedSound	= 9500
	End
	
	Behavior = FakePathfindPortalBehaviour ModuleTag_FAKEPATHFIND
		AllowEnemies			= No
		AllowNonSkirmishAIUnits	= No
	End
	
	Behavior = AIGateUpdate ModuleTage_AIGateUpdate
		TriggerWidthX = 300.0
		TriggerWidthY = 150.0
	End

	Behavior = InheritUpgradeCreate ModuleTag_InheritStonework
		Radius = BFA_ISENGARD_FORTRESS_WALL_EFFECTIVE_RADIUS
		Upgrade = Upgrade_MordorFortressMorgulSorcery
		ObjectFilter = ANY +MordorFortressCitadel
	End

	Behavior = AttributeModifierUpgrade ModuleTag_Reinforced
		TriggeredBy				= Upgrade_MordorFortressMorgulSorcery
		AttributeModifier		= IronPlatingExpansion_Bonus		
	End

	Behavior = ModelConditionUpgrade ModuleTag_ShowThePlating
		TriggeredBy			= Upgrade_MordorFortressMorgulSorcery		
		AddConditionFlags	= UPGRADE_NUMENOR_STONEWORK
		Permanent			= Yes
	End
	
	ArmorSet
		Conditions        = None
		Armor             = IsenWallArmor
		DamageFX          = None
	End
	
	;//	Geometry from small men wall gate
	GeometryIsSmall		  = No

	; right pillar
	Geometry              = BOX
	GeometryMajorRadius   = 10.0  
	GeometryMinorRadius   = 10.0  
	GeometryHeight        = 75
	GeometryOffset        = X:0 Y:50 Z:0
	
	; left pillar
	AdditionalGeometry    = BOX
	GeometryMajorRadius   = 10.0  
	GeometryMinorRadius   = 10.0  
	GeometryHeight        = 75
	GeometryOffset        = X:0 Y:-50 Z:0

	; Main
	AdditionalGeometry    = BOX
	GeometryName		  = "Closed"
	GeometryMajorRadius   = 9.0  
	GeometryMinorRadius   = 50.0  
	GeometryHeight        = 50
	
	; Left open
	AdditionalGeometry    = BOX
	GeometryName		  = "OpenLeft"
	GeometryMajorRadius   = 9.0  
	GeometryMinorRadius   = 10.0  
	GeometryHeight        = 40
	GeometryOffset        = X:0 Y:-30 Z:0
	
	; Right open
	AdditionalGeometry    = BOX
	GeometryName		  = "OpenRight"
	GeometryMajorRadius   = 9.0  
	GeometryMinorRadius   = 10.0  
	GeometryHeight        = 40
	GeometryOffset        = X:0 Y:30 Z:0
	
	// need some geometry points to tell enemy weapons where to hit.
	GeometryContactPoint = X:0	Y:50 Z:75
	GeometryContactPoint = X:0	Y:50 Z:10
	GeometryContactPoint = X:0	Y:-50 Z:10
	GeometryContactPoint = X:0	Y:-50 Z:75
	
 
	Shadow                = SHADOW_VOLUME
	BuildCompletion     = PLACED_BY_PLAYER
End
   
   
;----------------------------------------------------------------------
   
Object MordorWallCliffCap

	SelectPortrait  =  BPIWall
  
  ; *** ART Parameters ***
	
   Draw = W3DScriptedModelDraw ModuleTag_Draw
		OkToChangeModelColor  = Yes
		UseStandardModelNames = Yes
		DefaultModelConditionState
			Model = DolGulWall2
		End
		ModelConditionState  = DAMAGED UPGRADE_NUMENOR_STONEWORK
			Model         = DolGulWall2_d1
			Texture		  = dolgolgate_d.tga dolgolgate_d_u.tga
			Texture		  = dolgolgate_d1.tga dolgolgate_d1_u.tga
		End
	  	ModelConditionState  = UPGRADE_NUMENOR_STONEWORK
			Model         = DolGulWall2 
			Texture		  = dolgolgate.tga dolgolgate_u.tga
		End				
		IdleAnimationState
;			Flags = ADJUST_HEIGHT_BY_CONSTRUCTION_PERCENT
;			Animation				=	ReallyDamagedanimation
;				AnimationName		=	 GBWallrampart.GBWallrampart
;				AnimationMode		=	LOOP
; 			End
			StateName = STATE_None
		End	

		;--damaged building
	  
		ModelConditionState  = DAMAGED
			Model         = DolGulWall2_D1  
		End
		AnimationState = DAMAGED
		End	    
		
		ModelConditionState  = REALLYDAMAGED
			Model         = DolGulWall2_D2
		End
	    
;	    AnimationState = REALLYDAMAGED
;     		Animation				=	RubbleAnimation
;				AnimationName		=	 DolGulWall_D2.DolGulWall_D2
;				AnimationMode		=	ONCE
; 			End
;		    EnteringStateFX	= FX_BuildingReallyDamaged
;		End
 
;		ModelConditionState  = COLLAPSING
;			Model         = DolGulWall_D3
;		End
		
;		AnimationState = COLLAPSING
;     		Animation				=	RubbleAnimation
;				AnimationName		=	 DolGulWall_D3.DolGulWall_D3
;				AnimationMode		=	ONCE
; 			End
;		End

;		ModelConditionState  = RUBBLE
;			Model         = None  
;		End  
		
;		ModelConditionState  = POST_RUBBLE
;			Model         = NONE
;			ParticleSysBone NONE SmokeBuildingMediumRubble
;		End
		
;		AnimationState = POST_RUBBLE
;		End

;		ModelConditionState  = POST_COLLAPSE
;		Model         = None
;			ParticleSysBone NONE SmokeBuildingMediumRubble
;		End
		
;		AnimationState = POST_COLLAPSE
;		End 


	End

	Draw = W3DScriptedModelDraw ModuleTag_Draw_Rubble
		OkToChangeModelColor  = Yes
		UseStandardModelNames = Yes
		DefaultModelConditionState
			Model = None
		End
	
		ModelConditionState  = COLLAPSING
			Model         = GBWall_Rubble
		End
		
		ModelConditionState  = RUBBLE
			Model         = GBWall_Rubble
		End
	    
		ModelConditionState  = POST_RUBBLE
			Model         = GBWall_Rubble
		End

		ModelConditionState  = POST_COLLAPSE
			Model         = None
		End
	End
;    Draw = W3DFloorDraw ModuleTag_DrawFloor    
;;    		StaticModelLODMode = yes ; Will append M or L to the skin name depending on GameLOD
;  		ModelName = GBWallN_Bib
;	End
  
  ; ***DESIGN parameters ***
  DisplayName         = OBJECT:MordorWallCliffCap
  Side                = Mordor
  EditorSorting       = STRUCTURE
  ThreatLevel = 1.0
 
 
	CommandSet			= IsengardWallCliffCapCommandSet

 
  BuildCost           = BFA_MEN_WALLSEGMENT_SMALL_BUILDCOST
  BuildTime           = BFA_MEN_WALLSEGMENT_SMALL_BUILDTIME
  VisionRange         = BFA_MEN_WALLSEGMENT_SMALL_VISION_RANGE
  ShroudClearingRange = BFA_MEN_WALLSEGMENT_SMALL_SHROUD_CLEAR

  ; *** AUDIO Parameters ***
	#include "..\..\..\Includes\StandardBuildingEvaEvents.inc"
	SoundOnDamaged		= BuildingLightDamageStone
	SoundOnReallyDamaged	= BuildingHeavyDamageStone
    VoiceSelectUnderConstruction	= BuildingEvilVoiceSelectUnderConstruction

    UnitSpecificSounds
        UnderConstruction		= WallConstructionLoop  ; Built first time
		; UnderRepairFromDamage	= NoSound					; Repaired No animation on the building, so don't bother playing sound
		UnderRepairFromRubble	= WallConstructionLoop	; Repaired from completely destroyed (not used???)
    End

	;ClientBehavior = ModelConditionAudioLoopClientBehavior ModuleTag_PlayCollapseSound
	;	ModelCondition = REQUIRED:RUBBLE Sound:BuildingSink
	;End

	CampnessValue = CAMPNESS_WALL

  ; *** ENGINEERING Parameters ***
  RadarPriority       = STRUCTURE
  KindOf              = PRELOAD STRUCTURE SELECTABLE IMMOBILE SCORE DEFENSIVE_WALL MADE_OF_STONE CAN_CAST_REFLECTIONS
   ThreatBreakdown ThreatBreakdown_ModuleTag
	AIKindOf = WALL
   End
 
  Behavior            = GettingBuiltBehavior ModuleTag_04
	UseSpawnTimerWithoutWorker 		= Yes
   	SpawnTimer	= BFA_DEFAULT_STRUCTURE_HEALDELAY
	SelfBuildingLoop = WallConstructionLoop ; Only played if we DON'T spawn a worker
	SelfRepairFromDamageLoop  = NoSound         ; This doesn't cause an animation, so don't bother playing a sound
	SelfRepairFromRubbleLoop  = WallConstructionLoop
  End

  Body                = StructureBody ModuleTag_05
    MaxHealth         = BFA_MEN_WALLSEGMENT_SMALL_HEALTH
  End
 
;  Behavior            = DestroyDie ModuleTag_07
;    ;nothing
;  End
	
	// These should always appear together on wall segments
	Behavior = KeepObjectDie ModuleTag_IWantRubble 
		DeathTypes			= ALL -SUICIDED
	End
	Behavior            = SlowDeathBehavior ModuleTag_SlowDeath
		DeathTypes			= NONE +SUICIDED
		DestructionDelay = 5000
	End	
	  
  ArmorSet
		Conditions        = None
		Armor             = IsenWallArmor
		DamageFX          = None
	End


	Geometry              	= BOX
	GeometryMajorRadius   	= 10.0 
	GeometryMinorRadius   	= 40.0   
	GeometryHeight			= 80
	GeometryIsSmall			= No
	GeometryOffset			= X:0 Y:-20 Z:-40
  
  Shadow                = SHADOW_VOLUME
  BuildCompletion     = PLACED_BY_PLAYER
End

;---------------------------------------------------------------------------------------------------------

Object MordorWallCatapultSmall
 
  ; *** ART Parameters ***
  
  SelectPortrait  =  KUTrollSlingWallPortrait
  
	Draw = W3DScriptedModelDraw ModuleTag_Draw
		OkToChangeModelColor  = Yes
		UseStandardModelNames = Yes
		StaticModelLODMode		= yes ;// Will append M or L to the skin name depending on GameLOD

		DefaultModelConditionState
			Model = DolGuCat
		End
        WallBoundsMesh = P1
        ModelConditionState  = DAMAGED UPGRADE_NUMENOR_STONEWORK
			Model         = DolGuCat_D1
			Texture		  = dolgolgate_d.tga dolgolgate_d_u.tga
			Texture		  = dolgolgate_d1.tga dolgolgate_d1_u.tga
		End
	  	ModelConditionState  = UPGRADE_NUMENOR_STONEWORK
			Model         = DolGuCat 
			Texture		  = dolgolgate.tga dolgolgate_u.tga
		End			
		IdleAnimationState
;			Flags = ADJUST_HEIGHT_BY_CONSTRUCTION_PERCENT
;			Animation				=	ReallyDamagedanimation
;				AnimationName		=	 GBWallrampart.GBWallrampart
;				AnimationMode		=	LOOP
;  			End
;  			StateName = STATE_None
		End	
		
		
		;--damaged building
	  
		ModelConditionState  = DAMAGED
			Model         = DolGuCat_D1
		End
		AnimationState = DAMAGED
			EnteringStateFX	= FX_BuildingDamaged
		End

		ModelConditionState  = REALLYDAMAGED
		Model         = DolGuCat_D2
			ParticleSysBone FireSmall01 SmokeBuildingMedium
			ParticleSysBone FireSmall02 FireBuildingLarge
			ParticleSysBone FireSmall03 FireBuildingMedium
			ParticleSysBone FireSmall04 FireBuildingMedium
			ParticleSysBone FireSmall05 FireBuildingLarge
		End
	    
		AnimationState = REALLYDAMAGED
			EnteringStateFX	= FX_BuildingReallyDamaged
			Animation				=	RubbleAnimation
					AnimationName		=	DolGuCat_D2.DolGuCat_D2
					AnimationMode		=	ONCE
  			End
		End

		ModelConditionState  = RUBBLE
		Model         = DolGuCat_D3
		ParticleSysBone SmokeLarge01 SmokeBuildingLarge
		End
	    
		AnimationState = RUBBLE
			EnteringStateFX	= FX_StructureMediumCollapse
			Animation				=	RubbleAnimation
					AnimationName		=	DolGuCat_D3.DolGuCat_D3
					AnimationMode		=	ONCE
  			End
		End

		ModelConditionState  = POST_RUBBLE
			Model         = None
		End

		ModelConditionState  = POST_COLLAPSE
			Model         = None
		End
					
	End
 
 
	// ***DESIGN parameters ***
	DisplayName         = OBJECT:AngmarCastleWallCatapultSmall
	Side                = Angmar
	EditorSorting       = STRUCTURE
	ThreatLevel = 1.0
	 
	BuildCost           = BFA_DWARVEN_WALLCATAPULT_SMALL_BUILDCOST
	BuildTime           = BFA_DWARVEN_WALLCATAPULT_SMALL_BUILDTIME           ; in seconds
	VisionRange         = BFA_DWARVEN_WALLCATAPULT_SMALL_VISION_RANGE          ; Shroud clearing distance
	ShroudClearingRange = BFA_DWARVEN_WALLCATAPULT_SMALL_SHROUD_CLEAR
  	ArmorSet
		Conditions        = None
		Armor             = DwarvenWallArmor
		DamageFX          = None
	End
		

	// *** AUDIO Parameters ***

	#include "..\..\..\Includes\StandardBuildingEvaEvents.inc"

	VoiceSelect				= DwarvenCatapultExpansionSelect
	VoiceSelectUnderConstruction		= BuildingEvilVoiceSelectUnderConstruction

	SoundOnDamaged				= BuildingLightDamageStone
	SoundOnReallyDamaged			= BuildingHeavyDamageStone

	UnitSpecificSounds
		UnderConstruction		= WallConstructionLoop  	;Built first time
		; UnderRepairFromDamage	= NoSound					; Repaired No animation on the building, so don't bother playing sound
		UnderRepairFromRubble		= WallConstructionLoop		;Repaired from completely destroyed (not used???)
	End

	CampnessValue = CAMPNESS_WALL


	// *** ENGINEERING Parameters ***
	RadarPriority       = STRUCTURE
	KindOf              = PRELOAD STRUCTURE SELECTABLE IMMOBILE SCORE MADE_OF_STONE IGNORE_FOR_VICTORY WALL_UPGRADE // WALL_HUB

	ThreatBreakdown MenWallTrebuchetSmall_DetailedThreat
		AIKindOf = WALL
	End
 

 
	Behavior            			= GettingBuiltBehavior ModuleTag_04
		UseSpawnTimerWithoutWorker 		= Yes
		SpawnTimer	= BFA_DEFAULT_STRUCTURE_HEALDELAY
		RebuildTimeSeconds			= 30
		SelfBuildingLoop			= WallConstructionLoop			;Only played if we DON'T spawn a worker
		SelfRepairFromDamageLoop 	= NoSound						;This doesn't cause an animation, so don't bother playing a sound
		SelfRepairFromRubbleLoop	= WallConstructionLoop
	End

	Body                = StructureBody ModuleTag_05
		MaxHealth				= BFA_DWARVEN_WALLCATAPULT_SMALL_HEALTH
		MaxHealthDamaged		= BFA_DWARVEN_WALLCATAPULT_SMALL_HEALTH_DAMAGED
		MaxHealthReallyDamaged	= BFA_DWARVEN_WALLCATAPULT_SMALL_HEALTH_REALLY_DAMAGED
	End


	//Catapult Behaviors
	Behavior = ProductionUpdate ProductionUpdateModuleTag
	End
	Behavior = GrantUpgradeCreate ModuleTag_ActLikeAnOldUpgrade
		UpgradeToGrant = Upgrade_TrebuchetTurret
		GiveOnBuildComplete = Yes // The ExemptStatus UnderConstruction hack doesn't work on foundation buildings.
	End
	Behavior = CommandSetUpgrade ModueTag_TrebCommandSet
		TriggeredBy			= Upgrade_TrebuchetTurret
		ConflictsWith		= Upgrade_HasWallTrebuchet 
		CommandSet			= AngmarUpgradeCommandSetBuyNewCatapult
	End
	Behavior = CommandSetUpgrade ModueTag_TrebCommandSet3
		TriggeredBy			= Upgrade_HasWallTrebuchet Upgrade_TrebuchetTurret
		CommandSet			= SellableCommandSet
		RequiresAllTriggers	= Yes
	End
	Behavior = ObjectCreationUpgrade MakeTheFreeTreb
		TriggeredBy		= Upgrade_TrebuchetTurret
		Delay			= 0.0
		
		RemoveUpgrade	= Upgrade_WallTrebuchetButtonEnable
		GrantUpgrade	= Upgrade_HasWallTrebuchet
		DestroyWhenSold = Yes
		DeathAnimAndDuration = AnimState:DEATH_2 AnimTime:999999
		Offset			= X:0.0 Y:0.0 Z:46.9
	End
	Behavior = ObjectCreationUpgrade MakeTheFreeTreb2
		TriggeredBy		= Upgrade_HasWallTrebuchet
		ConflictsWith	= Upgrade_OpenGarrison Upgrade_PosternGate
		Delay			= 0.0
		
		RemoveUpgrade	= Upgrade_WallTrebuchetButtonEnable
		ThingToSpawn	= MordorFortressCatapult
		Offset			= X:0.0 Y:0.0 Z:60
		FadeInTime		= 600
	End
	Behavior = SlaveWatcherBehavior WatchTheTreb
		RemoveUpgrade		= Upgrade_HasWallTrebuchet			//when our slave dies, remove this upgrade, so we can get the upgrade again.
		GrantUpgrade		= Upgrade_WallTrebuchetButtonEnable	//when our slave dies, enable the button that allows us to buy a new one
		ShareUpgrades		= Yes								//So He'll get our Flaming Munitions
	End


	Behavior = AIUpdateInterface ModuleTag_SoWeCanUseWeapon
		AutoAcquireEnemiesWhenIdle	= Yes ATTACK_BUILDINGS
		MoodAttackCheckRate			= 250
	End


	Behavior				= SlowDeathBehavior ModuleTag_SlowDeath
		DeathTypes			= ALL
		DestructionDelay	= 5000
	End

	Behavior = SubObjectsUpgrade ModuleTag_ShowIceWalls
		TriggeredBy		= Upgrade_MordorFortressMorgulSorcery
		ShowSubObjects	= IceWall	 
	End

	Behavior = InheritUpgradeCreate ModuleTag_InheritStonework
		Radius = BFA_DWARVEN_FORTRESS_WALL_EFFECTIVE_RADIUS
		Upgrade = Upgrade_MordorFortressMorgulSorcery
		ObjectFilter = ANY +MordorFortressCitadel
	End

	Behavior = AttributeModifierUpgrade ModuleTag_Reinforced
		TriggeredBy			= Upgrade_MordorFortressMorgulSorcery
		AttributeModifier	= AngmarStoneworkExpansion_Bonus
		CustomAnimAndDuration	= AnimState:UPGRADE_NUMENOR_STONEWORK AnimTime:0
	End

	Behavior = ModelConditionUpgrade ModuleTag_ShowTheStones
		TriggeredBy			= Upgrade_MordorFortressMorgulSorcery		
		AddConditionFlags	= UPGRADE_NUMENOR_STONEWORK
		Permanent		= Yes
	End
		 
	GeometryIsSmall			= No

	Geometry              = BOX
	GeometryMajorRadius   = 8.0		; 10.0 
	GeometryMinorRadius   = 20.0	; 
	GeometryHeight        = 40.0	; 53.0
	GeometryIsSmall       = No
	
	AdditionalGeometry    	= CYLINDER
	GeometryMajorRadius   	= 25.0 
//	GeometryMinorRadius   	= 25.0 
	GeometryHeight        	= 50.0
	
	Shadow					= SHADOW_VOLUME
	BuildCompletion			= PLACED_BY_PLAYER
End

;---------------------------------------------
Object MordorWallTowerSmall
  ; *** ART Parameters ***
  
  	SelectPortrait = KUArrowTwrWallPortrait
  
  
	Draw = W3DScriptedModelDraw ModuleTag_Draw
		OkToChangeModelColor  = Yes
		UseStandardModelNames = Yes
		StaticModelLODMode		= yes ;// Will append M or L to the skin name depending on GameLOD

	
		ExtraPublicBone = Arrow_01
		ExtraPublicBone = Arrow_02
		ExtraPublicBone = Arrow_03
		ExtraPublicBone = Arrow_04
		ExtraPublicBone = Arrow_05
		ExtraPublicBone = Arrow_06
		ExtraPublicBone = Arrow_07
		ExtraPublicBone = Arrow_08
	
		DefaultModelConditionState
			Model				= DolGulTower2
			WeaponLaunchBone    = PRIMARY ARROW_
		End
		ModelConditionState  = DAMAGED UPGRADE_NUMENOR_STONEWORK
			Model         = DolGulTower2_d1
			Texture		  = dolgolgate_d.tga dolgolgate_d_u.tga
			Texture		  = dolgolgate_d1.tga dolgolgate_d1_u.tga
		End
	  	ModelConditionState  = UPGRADE_NUMENOR_STONEWORK
			Model         = DolGulTower2 
			Texture		  = dolgolgate.tga dolgolgate_u.tga
		End		
		IdleAnimationState
;			Flags = ADJUST_HEIGHT_BY_CONSTRUCTION_PERCENT
;			Animation				=	ReallyDamagedanimation
;				AnimationName		=	 GBWallrampart.GBWallrampart
;				AnimationMode		=	LOOP
;  			End
;  			StateName = STATE_None
		End	
		
				
		;--damaged building
	  
		ModelConditionState  = DAMAGED
			Model         = DolGulTower2_D1
		End
		AnimationState = DAMAGED
		End	    
		
		ModelConditionState  = REALLYDAMAGED
			Model         = DolGulTower2_D2
		End
		AnimationState = REALLYDAMAGED
		End
	

	End
 
	; ***DESIGN parameters ***
	DisplayName         = OBJECT:AngmarCastleWallTowerSmall
	Side                = Angmar
	EditorSorting       = STRUCTURE
	ThreatLevel			= 1.0
	ThreatBreakdown ModuleTag_DetailedThreat
		AIKindOf = WALL
	End
	 
	BuildCost           = BFA_DWARVEN_WALLTOWER_SMALL_BUILDCOST
	BuildTime           = BFA_DWARVEN_WALLTOWER_SMALL_BUILDTIME           ; in seconds
	VisionRange         = BFA_DWARVEN_WALLTOWER_SMALL_VISION_RANGE        ; Shroud clearing distance
	ShroudClearingRange = BFA_DWARVEN_WALLTOWER_SMALL_SHROUD_CLEAR

	CommandSet	= SellableCommandSet
  	ArmorSet
		Conditions        = None
		Armor             = DwarvenWallArmor
		DamageFX          = None
	End

	; *** AUDIO Parameters ***

	#include "..\..\..\Includes\StandardBuildingEvaEvents.inc"

	VoiceSelect						= NeutralArrowTowerSelect
	VoiceSelectUnderConstruction	= BuildingEvilVoiceSelectUnderConstruction

	SoundOnDamaged					= BuildingLightDamageStone
	SoundOnReallyDamaged			= BuildingHeavyDamageStone

	UnitSpecificSounds
		UnderConstruction		= WallConstructionLoop  	;Built first time
		; UnderRepairFromDamage	= NoSound					; Repaired No animation on the building, so don't bother playing sound
		UnderRepairFromRubble	= WallConstructionLoop		;Repaired from completely destroyed (not used???)
	End

	CampnessValue = CAMPNESS_WALL

	; *** ENGINEERING Parameters ***
	RadarPriority       = STRUCTURE
	KindOf              = PRELOAD STRUCTURE SELECTABLE IMMOBILE SCORE MADE_OF_STONE CAN_ATTACK IGNORE_FOR_VICTORY WALL_UPGRADE
 
	Behavior            			= GettingBuiltBehavior ModuleTag_04
		UseSpawnTimerWithoutWorker 		= Yes
		SpawnTimer	= BFA_DEFAULT_STRUCTURE_HEALDELAY
		RebuildTimeSeconds			= 30
		SelfBuildingLoop			= WallConstructionLoop			;Only played if we DON'T spawn a worker
		SelfRepairFromDamageLoop 	= WallConstructionLoop
		SelfRepairFromRubbleLoop	= WallConstructionLoop
	End

	WeaponSet
		Conditions			= None
		Weapon				= PRIMARY AngmarBattleTowerBow
		AutoChooseSources	= PRIMARY FROM_PLAYER FROM_SCRIPT FROM_AI
	End
 
	Behavior = AIUpdateInterface ModuleTag_SoWeCanUseWeapon
 		AutoAcquireEnemiesWhenIdle	= Yes
 		MoodAttackCheckRate			= 250
 	End
 
	  Body                = StructureBody ModuleTag_05
			MaxHealth			= BFA_DWARVEN_WALLSEGMENT_SMALL_HEALTH
			MaxHealthDamaged		= BFA_DWARVEN_WALLSEGMENT_SMALL_HEALTH_DAMAGED
			MaxHealthReallyDamaged		= BFA_DWARVEN_WALLSEGMENT_SMALL_HEALTH_REALLY_DAMAGED
	  End

	Behavior = SubObjectsUpgrade ModuleTag_ShowIceWalls
		TriggeredBy		= Upgrade_MordorFortressMorgulSorcery
		ShowSubObjects	= IceWall	 
	End	

	Behavior = InheritUpgradeCreate ModuleTag_InheritStonework
		Radius = BFA_DWARVEN_FORTRESS_WALL_EFFECTIVE_RADIUS
		Upgrade = Upgrade_MordorFortressMorgulSorcery
		ObjectFilter = ANY +MordorFortressCitadel
	End

	Behavior = AttributeModifierUpgrade ModuleTag_Reinforced
		TriggeredBy				= Upgrade_MordorFortressMorgulSorcery
		AttributeModifier		= AngmarStoneworkExpansion_Bonus
		CustomAnimAndDuration	= AnimState:UPGRADE_NUMENOR_STONEWORK AnimTime:0
	End

	Behavior = ModelConditionUpgrade ModuleTag_ShowTheStones
		TriggeredBy			= Upgrade_MordorFortressMorgulSorcery		
		AddConditionFlags	= UPGRADE_NUMENOR_STONEWORK
		Permanent			= Yes
	End
	 
	Behavior            = SlowDeathBehavior ModuleTag_SlowDeath
		DeathTypes			= ALL
		DestructionDelay	= 5000
	End												

	GeometryIsSmall       = No
	
	Geometry			  = BOX
	GeometryMajorRadius   = 15.0 
	GeometryMinorRadius   = 15.0 
	GeometryHeight        = 40.0
	
	AdditionalGeometry    = BOX
	GeometryMajorRadius   = 10.0 
	GeometryMinorRadius   = 10.0 
	GeometryHeight        = 50.0
	GeometryOffset		  = X:0 Y:0 Z:40
	
	AdditionalGeometry    = BOX
	GeometryMajorRadius   = 8.0		; 10.0 
	GeometryMinorRadius   = 20.0	; 
	GeometryHeight        = 40.0	; 53.0
	GeometryIsSmall       = No


	
	Shadow                = SHADOW_VOLUME
	BuildCompletion     = PLACED_BY_PLAYER
End


   
   
